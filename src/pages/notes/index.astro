---
// src/pages/notes/index.astro
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const allNotes = await getCollection('notes');

// --- üîß Ê†∏ÂøÉÈÄªËæëÔºöÊåâÊñá‰ª∂Â§πÂàÜÁªÑ ---
const folderMap = new Map();

allNotes.forEach(note => {
  // ÂÅáËÆæ slug ÊòØ "ros2/installation"ÔºåÈÇ£‰πà split('/')[0] Â∞±ÊòØ "ros2"
  // Â¶ÇÊûúÊñá‰ª∂Áõ¥Êé•Âú®Ê†πÁõÆÂΩï (Ê≤°ÊúâÊñá‰ª∂Â§π)ÔºåÊàë‰ª¨Â∞±ÊääÂÆÉÂΩíÁ±ª‰∏∫ "General"
  const slugParts = note.slug.split('/');
  const folderName = slugParts.length > 1 ? slugParts[0] : 'General';
  
  if (!folderMap.has(folderName)) {
    folderMap.set(folderName, 0);
  }
  // ÁªüËÆ°ÊØè‰∏™Êñá‰ª∂Â§πÈáåÊúâÂá†ÁØáÊñáÁ´†
  folderMap.set(folderName, folderMap.get(folderName) + 1);
});

// ËΩ¨Êç¢ÊàêÊï∞ÁªÑÊñπ‰æøÊ∏≤Êüì
const folders = Array.from(folderMap.entries()).map(([name, count]) => ({ name, count }));
---

<BaseLayout title="Library">
  <div class="library-container">
    
    <header class="lib-header">
      <a href="/" class="back-link">‚Üê Home</a>
      <h1>Library.</h1>
      <p>Structured notes organized by topics.</p>
    </header>

    <div class="folder-grid">
      {folders.map(folder => (
        <a href={folder.name === 'General' ? '#' : `/notes/folder/${folder.name}`} class="folder-card clean-card">
          <div class="folder-icon">üìÇ</div>
          <div class="folder-info">
            <h3>{folder.name}</h3>
            <span>{folder.count} notes</span>
          </div>
          <div class="folder-arrow">‚Üí</div>
        </a>
      ))}
    </div>

  </div>
</BaseLayout>

<style>
  .library-container { max-width: 1000px; margin: 0 auto; padding: 4rem 1.5rem; }
  
  .lib-header { margin-bottom: 4rem; text-align: center; }
  .back-link { color: #999; font-weight: 600; font-size: 0.9rem; }
  .lib-header h1 { font-family: 'Playfair Display', serif; font-size: 3rem; margin: 0.5rem 0; color: var(--text-main); }
  .lib-header p { color: var(--text-sub); }

  /* Êñá‰ª∂Â§πÁΩëÊ†º */
  .folder-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 1.5rem;
  }

  .folder-card {
    display: flex;
    align-items: center;
    padding: 1.5rem;
    text-decoration: none;
    color: inherit;
    background: #fff;
    border: 1px solid rgba(0,0,0,0.05);
    border-radius: 12px;
    transition: all 0.2s;
  }

  .folder-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 10px 20px rgba(0,0,0,0.05);
    border-color: var(--accent-library);
  }

  .folder-icon { font-size: 2rem; margin-right: 1rem; }
  
  .folder-info { flex: 1; }
  .folder-info h3 { margin: 0; font-size: 1.1rem; text-transform: capitalize; }
  .folder-info span { font-size: 0.85rem; color: #888; }

  .folder-arrow { color: #ccc; font-weight: bold; }
  .folder-card:hover .folder-arrow { color: var(--accent-library); }
</style>